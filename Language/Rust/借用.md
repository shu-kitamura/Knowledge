# 借用（borrowing）

## 概要

借用について記載する。

## 説明

**借用（borrowing）**とはある変数の参照を得ること。

### 不変参照

破壊的代入ができない変数から得る参照。
``` rust
let a = 10;
let b = &a; // a の不変参照を得ている。
```

### 可変参照

破壊的代入ができる変数から得る参照。
``` rust
let mut a = 10;
let b = &mut a; // a の可変参照を得ている。
*b = 15;        // 破壊的代入を行うと、a の値も変更される。
```

可変参照の借用には以下の制約が課される。
1. ある時点で書き込み可能な状態の変数（参照を含む）は最大で1つである。
1. ある時点で不変参照が1つ以上存在する場合、書き込み可能な状態にある変数（参照を含む）1つも存在しない。

以下のソースコードは制約の「1」に反する。
``` rust
let mut a = 10; // (1) オリジナルの変数を定義
let b = &mut a; // (2) a の可変参照を得る
let c = b;      // (3) a の可変参照が b から c に移る
*c = 20;        // (4) c の値を更新（≒ a, b も更新される）
*b = 30;        // (5) 制約「1」に反するため、コンパイルエラー
a = 40;         // (5') 〃
```

以下のソースコードは制約の「2」に反する。
``` rust
let mut a = 10; // (1) オリジナルの変数を定義
let b = &a;     // (2) a の不変参照を得る
let c = &mut b; // (3) a の不変参照を得るが、制約「2」に反するためコンパイルエラー
```

#### 排他制御との類似性

並行プログラミングでは、並行して動作するプロセスがあるとき、共有リソースへの同時アクセスを制限する必要がある。
この制御は _排他制御_ と呼ばれる。

可変参照の借用の制約は、**リードライトロック（RWロック）**と呼ばれる制約（排他制御と同じ制約）を担保している。
