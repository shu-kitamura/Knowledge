# データの生成・操作・変換

## 概要

SQLでデータ（文字列、数値など）の生成、操作、変換に使えるノウハウや、仕様を記載する。

## varchar型の文字数を超えたときの挙動

以下の30文字のvarchar型を定義したテーブルに、  
``` sql
CREATE TABLE string_tbl
 (char_fld CHAR(30),
  vchar_fld VARCHAR(30),
  text_fld TEXT
 );
```

以下のような、30文字を超える値を更新/挿入とした場合の挙動  
``` sql
UPDATE string_tbl
SET vchar_fld = 'This is a piece of extremely long varchar data';
```

sql_modeの設定値によって、挙動が異なる。  

|モード |動作 |
|--|--|
| stric(規定値) | 例外を出す |
| ansi | 超過分の文字列を切り捨てて挿入（警告は出る） |


sql_modeを変更する方法は以下
``` sql
SET sql_mode='ansi';
```

## 少数の制度を制御(少数丸める)

ceil, floor, round, truncateの関数を使う  

|関数 |動作 |
|--|--|
| ceil | 小数点以下切り上げ |
| floor | 小数点以下切り捨て |
| round | 中間点で切り上げ/捨てを判断（四捨五入） |
| truncate | 小数第X位以下切り捨て |


各関数の実行結果
```sql
> SELECT CEIL(72.445), FLOOR(72.445);
+--------------+---------------+
| CEIL(72.445) | FLOOR(72.445) |
+--------------+---------------+
|           73 |            72 |
+--------------+---------------+
1 row in set (0.00 sec)

> SELECT ROUND(72.0909, 1), ROUND(72.0909, 2), ROUND(72.0909, 3);
+-------------------+-------------------+-------------------+
| ROUND(72.0909, 1) | ROUND(72.0909, 2) | ROUND(72.0909, 3) |
+-------------------+-------------------+-------------------+
|              72.1 |             72.09 |            72.091 |
+-------------------+-------------------+-------------------+
1 row in set (0.00 sec)

> SELECT TRUNCATE(72.0909, 1), TRUNCATE(72.0909, 2), TRUNCATE(72.0909, 3);
+----------------------+----------------------+----------------------+
| TRUNCATE(72.0909, 1) | TRUNCATE(72.0909, 2) | TRUNCATE(72.0909, 3) |
+----------------------+----------------------+----------------------+
|                 72.0 |                72.09 |               72.090 |
+----------------------+----------------------+----------------------+
1 row in set (0.00 sec)
```